@if (user()) {
<div class="flex flex-col h-screen bg-gray-900 text-gray-200 font-sans">
  <app-header 
    (viewChanged)="handleViewChange($event)" 
    (globalNotesToggled)="toggleGlobalNotes(true)"
    [currentView]="currentView()">
  </app-header>
  
  <main class="flex-grow pt-0 px-2 pb-2 overflow-y-auto">
    <div class="max-w-7xl mx-auto">
      @switch (currentView()) {
        @case ('monthly') {
          <app-monthly-report></app-monthly-report>
        }
        @case ('summary') {
          <app-summary-view (navigateToMonthlyView)="currentView.set('monthly')"></app-summary-view>
        }
        @case ('import-export') {
          <app-import-export></app-import-export>
        }
        @case ('calculator') {
          <app-calculator></app-calculator>
        }
        @case ('search') {
          <app-search-expenses (navigateToMonthlyView)="currentView.set('monthly')"></app-search-expenses>
        }
      }
    </div>
  </main>
</div>

@if(showGlobalNotes()) {
  <app-global-notes (close)="toggleGlobalNotes(false)"></app-global-notes>
}

<!-- Update Notification Bar -->
@if (updateAvailable()) {
  <div class="fixed bottom-4 left-4 right-4 z-[100] animate-bounce">
    <div class="bg-indigo-600 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center justify-between gap-4 border border-indigo-400/30 backdrop-blur-md">
      <div class="flex items-center gap-3">
        <div class="bg-white/20 p-2 rounded-lg">
          <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
        </div>
        <div>
          <p class="font-bold text-sm">Nuova versione disponibile!</p>
          <p class="text-xs text-indigo-100">Aggiorna per vedere le ultime novit√†.</p>
        </div>
      </div>
      <button (click)="applyUpdate()" class="bg-white text-indigo-600 px-4 py-2 rounded-xl text-sm font-bold hover:bg-indigo-50 transition-colors shadow-lg">
        Aggiorna ora
      </button>
    </div>
  </div>
}
} @else {
  <app-login></app-login>
}
