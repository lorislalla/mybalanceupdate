<div class="space-y-6">
  <div class="bg-gray-800 p-4 mt-4 rounded-lg shadow-lg">
    <h1 class="text-xl font-bold text-indigo-400 mb-4 text-center">Calcolatore Rapido</h1>

    <!-- Add New Item -->
    <div class="flex flex-col sm:flex-row items-end gap-2 mb-6 bg-gray-900 p-3 rounded-md">
      <!-- Color Picker for New Item -->
      <div class="w-10 flex-shrink-0">
        <label class="block text-[10px] font-medium text-gray-400 mb-1 text-center">Tinta</label>
        <input type="color" [ngModel]="newColor()" (ngModelChange)="newColor.set($event)" class="w-full h-8 p-0 border-0 rounded cursor-pointer bg-transparent" title="Scegli colore" />
      </div>

      <div class="w-full sm:flex-grow">
        <label class="block text-[10px] font-medium text-gray-400 mb-1">Nuova Voce</label>
        <input
          type="text"
          [ngModel]="newDescription()"
          (ngModelChange)="newDescription.set($event)"
          placeholder="Es. Conto in banca"
          class="w-full bg-gray-800 focus:outline-none border border-gray-700 rounded-md p-1.5 text-sm text-gray-200 focus:ring-1 focus:ring-indigo-500 transition"
          (keyup.enter)="addItem()"
        />
      </div>
      <div class="w-full sm:w-32">
        <label class="block text-[10px] font-medium text-gray-400 mb-1">Importo (€)</label>
        <input
          type="number"
          [ngModel]="newAmount()"
          (ngModelChange)="newAmount.set($event)"
          placeholder="0.00"
          class="w-full bg-gray-800 border border-gray-700 rounded-md p-1.5 text-sm text-gray-200 focus:ring-1 focus:ring-indigo-500 transition"
          (keyup.enter)="addItem()"
        />
      </div>
      <button (click)="addItem()" [disabled]="!newDescription() || newAmount() === null" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 disabled:text-gray-500 text-white font-semibold py-1.5 px-3 rounded-md text-sm transition-colors">
        Aggiungi
      </button>
    </div>

    <!-- Items List -->
    <div cdkDropList (cdkDropListDropped)="drop($event)" class="space-y-1">
      @for(item of items(); track item.id) {
      <div cdkDrag class="flex items-center gap-2 bg-gray-900 p-1.5 rounded-md animate-fade-in group hover:bg-gray-850 transition-colors border-l-4" [style.border-left-color]="item.color || '#6366f1'">
        <!-- Drag Handle -->
        <div class="cdk-drag-handle cursor-move text-gray-500 hover:text-gray-300 p-1" title="Trascina per riordinare">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </div>

        <!-- Color Picker (Compact) -->
        <input type="color" [ngModel]="item.color || '#6366f1'" (ngModelChange)="updateItem(item.id, 'color', $event)" class="w-4 h-4 p-0 border-0 rounded-full cursor-pointer bg-transparent overflow-hidden" title="Cambia colore" />

        <!-- Description Input -->
        <input
          type="text"
          [ngModel]="item.description"
          (ngModelChange)="updateItem(item.id, 'description', $event)"
          class="flex-grow w-full bg-transparent border-b border-transparent hover:border-gray-700 focus:border-indigo-500 focus:outline-none py-0.5 px-1 text-sm text-gray-300 transition"
        />

        <!-- Amount Input -->
        <div class="flex items-center gap-2 flex-shrink-0">
          <input
            type="number"
            [ngModel]="item.amount"
            (ngModelChange)="updateItem(item.id, 'amount', +$event)"
            class="w-24 bg-transparent border-b border-transparent hover:border-gray-700 focus:border-indigo-500 focus:outline-none py-0.5 px-1 text-sm text-right font-mono transition"
            [class.text-green-400]="item.amount >= 0"
            [class.text-red-400]="item.amount < 0"
          />
          <button (click)="removeItem(item.id)" class="text-gray-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1" title="Rimuovi">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>
        </div>

        <!-- Drag Preview -->
        <div *cdkDragPreview class="bg-gray-800 p-2 rounded-lg shadow-xl text-gray-200 border-l-4" [style.border-left-color]="item.color || '#6366f1'">{{ item.description }} - {{ item.amount }} €</div>
        <div *cdkDragPlaceholder class="opacity-0"></div>
      </div>
      } @empty {
      <div class="text-center py-8 text-gray-500 text-sm">
        <p>Aggiungi voci per calcolare il totale.</p>
      </div>
      }
    </div>

    <!-- Total -->
    @if(items().length > 0) {
    <div class="mt-6 pt-4 border-t border-gray-700 flex flex-col items-center">
      <span class="text-gray-400 mb-1 uppercase tracking-wider text-xs">Totale Calcolato</span>
      <div class="text-3xl font-extrabold" [class.text-green-400]="total() >= 0" [class.text-red-400]="total() < 0">{{ total() | number : '1.2-2' }} €</div>
    </div>
    }
  </div>
</div>
